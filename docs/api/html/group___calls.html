<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Croc: Function calling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="crocstyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="container">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<img src="http://jfbillingsley.com/croc/chrome/site/banner.gif" alt="The Croc Programming Language" />
<!-- <table cellspacing="0" cellpadding="0"> -->
 <!-- <tbody> -->
 <!-- <tr style="height: 56px;"> -->
  <!-- <td style="padding-left: 0.5em;"> -->
   <!-- <div id="projectname">Croc -->
   <!-- </div> -->
   <!--<div id="projectbrief">The Croc Programming Language</div>-->
  <!-- </td> -->
 <!-- </tr> -->
 <!-- </tbody> -->
<!-- </table> -->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>API</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Function calling<div class="ingroups"><a class="el" href="group___a_p_i.html">API</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga594131bb61155ebdc000ca67fb96abcf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___a_p_i_types.html#gadcf7542809ee167fbe38441459138101">uword_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a> (<a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *t, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> slot, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> numReturns)</td></tr>
<tr class="separator:ga594131bb61155ebdc000ca67fb96abcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3970ddd18fd3cd859bb011fba372d702"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group___a_p_i_types.html#gadcf7542809ee167fbe38441459138101">uword_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___calls.html#ga3970ddd18fd3cd859bb011fba372d702">croc_methodCall</a> (<a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *t, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> slot, const char *name, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> numReturns)</td></tr>
<tr class="separator:ga3970ddd18fd3cd859bb011fba372d702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0dd0b7f464ba87bab25d991709711f0b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___calls.html#ga0dd0b7f464ba87bab25d991709711f0b">croc_tryCall</a> (<a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *t, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> slot, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> numReturns)</td></tr>
<tr class="separator:ga0dd0b7f464ba87bab25d991709711f0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e89a6bd359a72d35e2205c047863f79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___calls.html#ga4e89a6bd359a72d35e2205c047863f79">croc_tryMethodCall</a> (<a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *t, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> slot, const char *name, <a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a> numReturns)</td></tr>
<tr class="separator:ga4e89a6bd359a72d35e2205c047863f79"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Function calling and the native equivalent of 'try'. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga594131bb61155ebdc000ca67fb96abcf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___a_p_i_types.html#gadcf7542809ee167fbe38441459138101">uword_t</a> croc_call </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>numReturns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a function call. </p>
<p>The process of calling a function goes something like this:</p>
<ol type="1">
<li>Push the function (or other object) that you want to call.</li>
<li>Push the 'this' parameter (or null if it doesn't matter). This is equivalent to 'with' in Croc, except you always have to pass it in the native API.</li>
<li>Push any parameters.</li>
<li>Call <code>croc_call</code> with the slot of the thing you want to call.</li>
<li>Optionally deal with any return values.</li>
</ol>
<p>As an example, let's call the <code>toString</code> function on an integer:</p>
<div class="fragment"><div class="line"><a class="code" href="group___variables.html#gaba8deb6f8dd7e2304422552b28b31c4c">croc_pushGlobal</a>(t, <span class="stringliteral">&quot;toString&quot;</span>);        <span class="comment">// push the function</span></div>
<div class="line"><a class="code" href="group___value_types.html#gad65bac10b997ab3513eeb8abaa2eb98f">croc_pushNull</a>(t);                      <span class="comment">// push &#39;this&#39; (null cause we don&#39;t care)</span></div>
<div class="line"><a class="code" href="group___value_types.html#gab438605ef24ddb878ac7592ee1f31da7">croc_pushInt</a>(t, 5);                    <span class="comment">// push parameters</span></div>
<div class="line"><a class="code" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a>(t, -3, 1);                   <span class="comment">// call the third-from-top slot (toString), and have it return 1 value</span></div>
<div class="line">printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="group___value_types.html#ga7d026507a1fcd30359365c550274991c">croc_getString</a>(t, -1)); <span class="comment">// print out the return value (prints 5)</span></div>
<div class="line"><a class="code" href="group___stack.html#gaa4e1fff730ab9c3148f5862fea915a47">croc_popTop</a>(t);                        <span class="comment">// stack is now exactly as it was when we started</span></div>
</div><!-- fragment --><p>When you use <code>croc_call</code>, all the slots above <code>slot</code> are considered its parameters. All the slots starting at <code>slot</code> are removed from the stack and replaced with the return values upon return.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slot</td><td>is the slot to call. There must be at least one slot on the stack above this slot for the 'this' parameter. </td></tr>
    <tr><td class="paramname">numReturns</td><td>is how many return values you want left on the stack. This can be -1, which means "as many values
    as were returned". </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>how many values were returned from the call. If <code>numReturns</code> &gt;= 0, then this is the same as <code>numReturns</code>, but if it was -1 this is how you find out how many values are sitting on top of the stack. </dd></dl>

</div>
</div>
<a class="anchor" id="ga3970ddd18fd3cd859bb011fba372d702"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___a_p_i_types.html#gadcf7542809ee167fbe38441459138101">uword_t</a> croc_methodCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>numReturns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs a method call. </p>
<p>The way you use this is almost identical to <a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a>, except instead of pushing the thing to call, you push the thing to call the method on. For example, let's call the "writeln" method of <code>console.stderr:</code> </p>
<div class="fragment"><div class="line"><a class="code" href="group___ex_common.html#gaf4549f85a03b21e6d0e2ec815d951721">croc_ex_lookup</a>(t, <span class="stringliteral">&quot;console.stderr&quot;</span>);        <span class="comment">// push the object</span></div>
<div class="line"><a class="code" href="group___value_types.html#gad65bac10b997ab3513eeb8abaa2eb98f">croc_pushNull</a>(t);                           <span class="comment">// still have to push something here..</span></div>
<div class="line"><a class="code" href="group___value_types.html#ga5402e81ac342c23568488d0ec2f698e0">croc_pushString</a>(t, <span class="stringliteral">&quot;Bad things happened!&quot;</span>); <span class="comment">// push parameters</span></div>
<div class="line"><a class="code" href="group___calls.html#ga3970ddd18fd3cd859bb011fba372d702">croc_methodCall</a>(t, -3, <span class="stringliteral">&quot;writeln&quot;</span>, 0);       <span class="comment">// call method, expect no results</span></div>
<div class="line"><span class="comment">// stack is now exactly as it was when we started</span></div>
</div><!-- fragment --><p>Notice that you still have to push a slot after the object. The value of this slot will always be ignored and overwritten with the object. It's just there to make the API the same as <a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a> and to simplify the implementation of this function (so it doesn't have to shift the parameters up).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slot</td><td>is the slot holding the object on which the method will be called. </td></tr>
    <tr><td class="paramname">name</td><td>is the name of the method to call. </td></tr>
    <tr><td class="paramname">numReturns</td><td>is how many return values you want left on the stack, or -1 to get all values returned. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>how many values were returned from the call, just like <a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a>. </dd></dl>

</div>
</div>
<a class="anchor" id="ga0dd0b7f464ba87bab25d991709711f0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int croc_tryCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>numReturns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Just like <a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a>, but sets up an exception frame around the call. </p>
<p>This is like using a try-catch block in Croc. The way you use it is exactly the same as <a class="el" href="group___calls.html#ga594131bb61155ebdc000ca67fb96abcf">croc_call</a>, except for the return value. If the call completed successfully, the return value will be &gt;= 0. If an exception was thrown (and caught by this exception frame), it will return <a class="el" href="group___a_p_i_types.html#gga3f8163f5fc2f63a43e5aa1a93fd1c4ada0361cff9aed9e4d3a5a7ac5c2cf1e54d">CrocCallRet_Error</a>. In this case, the exception object will be sitting on top of the stack (replacing the function and its parameters, just like when it returns values normally). You can then do whatever you want, such as handling the exception, or doing some cleanup and rethrowing it with <a class="el" href="group___e_h.html#ga59c426aeb7a518c959e9ad854403e570">croc_eh_rethrow</a>.</p>
<p>It's also good practice to see if the exception you caught was a <code>HaltException</code>. If so, you should rethrow it. You can use the <a class="el" href="group___ex_common.html#gae85f7fa81af2f98938657e36ee36b90f">croc_ex_isHaltException</a> function to easily see if it is. </p>

</div>
</div>
<a class="anchor" id="ga4e89a6bd359a72d35e2205c047863f79"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int croc_tryMethodCall </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#ga6a1f60650d3a078e26815cda6fd01d18">CrocThread</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___a_p_i_types.html#gab14ee9a38c2105a6776912612194c348">word_t</a>&#160;</td>
          <td class="paramname"><em>numReturns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Just like <a class="el" href="group___calls.html#ga3970ddd18fd3cd859bb011fba372d702">croc_methodCall</a>, but sets up an exception frame around the call like <a class="el" href="group___calls.html#ga0dd0b7f464ba87bab25d991709711f0b">croc_tryCall</a>. </p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 15 2014 10:46:48 for Croc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</div> <!-- container -->
</body>
</html>
