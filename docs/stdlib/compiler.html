<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="text/javascript" http-equiv="content-script-type"><title>module compiler</title><link rel="stylesheet" type="text/css" href="candydoc/style.css"><link rel="stylesheet" type="text/css" href="candydoc/code.css"><script language="JavaScript" src="candydoc/util.js" type="text/javascript"></script><script language="JavaScript" src="candydoc/tree.js" type="text/javascript"></script><script language="JavaScript" src="candydoc/explorer.js" type="text/javascript"></script></head><body><div id="everything"><div id="tabarea"></div><div id="explorerclient"></div><div id="content"><script>explorer.initialize("compiler");</script>	<img src="candydoc/img/banner.gif" alt="The Croc Programming Language"></img>	<div id="docbody">		<h1>module compiler</h1><p>This module gives you access to the Croc compiler. Often you won't need to deal with the compiler directly as the module system takes care of loading most of your code, but if you need to dynamically compile something or write a new module system, this is the interface.</p><script>explorer.outline.incSymbolLevel();</script><dl><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="setFlags"></a>global function setFlags(vararg)<script>explorer.outline.addDecl("setFlags");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Enable and disable VM-wide compiler flags. These control whether or not code is generated for various optional language features.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">vararg</td><td><p>are strings which represent the flags. The valid flags are as follows: <ul><li><p><tt>"typeconstraints"</tt> enables code generation for parameter type constraints. If you leave out this flag, no parameter typechecking is done when calling functions.</p></li><li><p><tt>"asserts"</tt> enables code generation for <tt>assert()</tt> statements. If you leave out this flag, assert statements become no-ops.</p></li><li><p><tt>"debug"</tt> enables outputting debug info (which includes line numbers, local variable info, and upvalue names). If you leave out this flag, no debug info will be emitted, saving space at the cost of worse error messages/tracebacks. <strong><em>This flag does not yet work properly.</em> Debug info is always on.</strong></p></li><li><p><tt>"docs"</tt> will cause the compiler to parse documentation comments and place doc decorators on the program items they document, meaning run-time accessible documentation will be available. If you leave out this flag, doc comments are ignored (unless you use one of the DT compilation functions below).</p></li><li><p><tt>"all"</tt> is the same as specifying <tt>"typeconstraints"</tt>, <tt>"asserts"</tt>, and <tt>"debug"</tt>.</p></li><li><p><tt>"alldocs"</tt> is the same as specifying <tt>"all"</tt> and <tt>"docs"</tt>.</p></li></ul></p></td></tr></table><p><strong>Returns:</strong> <p>an array of strings containing the compiler flags as they were before this function was called. This way you can set the compiler flags and then return them to how they were:</p><p><div class="code"><pre><span class="k">local</span> <span class="n">oldFlags</span> <span class="p">=</span> <span class="n">compiler</span><span class="p">.</span><span class="n">setFlags</span><span class="p">(</span><span class="s">&quot;alldocs&quot;</span><span class="p">)</span>

<span class="c1">// do some compilation here.</span>

<span class="n">compiler</span><span class="p">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">oldFlags</span><span class="p">.</span><span class="n">expand</span><span class="p">())</span> <span class="c1">// restore old flags</span>
</pre></div>
</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="getFlags"></a>global function getFlags()<script>explorer.outline.addDecl("getFlags");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p><strong>Returns:</strong> <p>an array of strings containing the compiler's currently enabled flags. See <a href="compiler.html#setFlags">setFlags</a> for which strings it may return (except for <tt>"all"</tt> and <tt>"alldocs"</tt>).</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileModule"></a>global function compileModule(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileModule");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Compiles a Croc module.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">source</td><td><p>is the source code of the module.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">filename</td><td><p>is the filename which will be used in compiler errors and debug locations.</p></td></tr></table><p><strong>Returns:</strong> <p>different things depending on whether or not compilation was successful. If you don't care about handling compilation errors, see the <a href="compiler.html#compileModuleEx">compileModuleEx</a> function instead.</p><p>If compilation was successful, returns two values: the first is an uninstantiated <tt>funcdef</tt> that represents the module's top-level function, and the second is a string containing the module's name as was given in its <tt>module</tt> statement. You can use this to check whether the name matches the filename or whatever.</p><p>If compilation failed, returns two values: the exception object (an <tt>instance</tt>) which the compiler threw, and a string explaining what kind of error it was. These are the possible values for this string:</p><p><ul><li><p><tt>"unexpectedeof"</tt> means that the compiler was expecting more code, but the source ended before it could finish parsing.</p></li><li><p><tt>"lonestatement"</tt> means that the compiler encountered a statement which, on its own, could not possibly have a side effect and is therefore illegal.</p></li><li><p><tt>"danglingdoc"</tt> means that the compiler found a documentation comment at the end of the source code which isn't attached to any declaration.</p></li><li><p><tt>"error"</tt> means any other kind of compilation error.</p></li></ul></p><p>These "failure modes" are mostly useful for implementing interactive Croc interpreters. For example, an <tt>"unexpectedeof"</tt> or <tt>"danglingdoc"</tt> error might just mean that the user has to type another line to finish the code, whereas a <tt>"lonestatement"</tt> error might mean that evaluating the code as an expression and displaying its result would be better.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileStmts"></a>global function compileStmts(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileStmts");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Compiles a list of Croc statements. Almost identical to <a href="compiler.html#compileModule">compileModule</a> except there should be no <tt>module</tt> statement at the beginning of the code.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">source</td><td><p>is the source code.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">filename</td><td><p>is the filename which will be used in compiler errors and debug locations.</p></td></tr></table><p><strong>Returns:</strong> <p>different things depending on whether or not compilation was successful. If you don't care about handling compilation errors, see the <a href="compiler.html#compileStmtsEx">compileStmtsEx</a> function instead.</p><p>If compilation was successful, returns an uninstantiated <tt>funcdef</tt> that represents an anonymous function which contains the statements. It's just like a module's top-level function.</p><p>If compilation failed, it returns the exact same things as <a href="compiler.html#compileModule">compileModule</a>.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileExpr"></a>global function compileExpr(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileExpr");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Compiles a single Croc expression into a function which takes variadic arguments and returns the result of evaluating that expression.</p><p>For example, compiling the string <tt>"3 + vararg[0]"</tt> as an expression will give you a function which is essentially <tt>\vararg -&gt; 3 + vararg[0]</tt>.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">source</td><td><p>is the string containing the expression. It must comprise a single expression; if there is any extra code after it, it is a compilation error.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">filename</td><td><p>is the filename which will be used in compiler errors and debug locations.</p></td></tr></table><p><strong>Returns:</strong> <p>different things depending on whether or not compilation was successful. If you don't care about handling compilation errors, see the <a href="compiler.html#compileExprEx">compileExprEx</a> function instead.</p><p>If compilation was successful, returns an uninstantiated <tt>funcdef</tt> that represents the function as described above.</p><p>If compilation failed, it returns the exact same things as <a href="compiler.html#compileModule">compileModule</a>.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileModuleDT"></a>global function compileModuleDT(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileModuleDT");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Works just like <a href="compiler.html#compileModule">compileModule</a> but additionally extracts the module's top-level documentation table as described in the spec.</p><p>When you use this function, doc comments are parsed and turned into doctables, regardless of whether the compiler's <tt>"docs"</tt> flag is enabled. The <tt>"docs"</tt> compiler flag only controls whether or not runtime doc decorators are attached to program items.</p><p>The parameters are the same as <a href="compiler.html#compileModule">compileModule</a>.</p><p><strong>Returns:</strong> <p>different things depending on whether or not compilation was successful. If you don't care about handling compilation errors, see the <a href="compiler.html#compileModuleDTEx">compileModuleDTEx</a> function instead.</p><p>If compilation was successful, it returns three values: the first two are the same as <a href="compiler.html#compileModule">compileModule</a>, and the third is the documentation table.</p><p>If compilation failed, it returns the exact same things as <a href="compiler.html#compileModule">compileModule</a>.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileStmtsDT"></a>global function compileStmtsDT(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileStmtsDT");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>This is to <a href="compiler.html#compileStmts">compileStmts</a> as <a href="compiler.html#compileModuleDT">compileModuleDT</a> is to <a href="compiler.html#compileModule">compileModule</a>.</p><p><strong>Returns:</strong> <p>different things depending on whether or not compilation was successful. If you don't care about handling compilation errors, see the <a href="compiler.html#compileStmtsDTEx">compileStmtsDTEx</a> function instead.</p><p>If compilation was successful, it returns two values: the first is the same as <a href="compiler.html#compileStmts">compileStmts</a>, and the second is the documentation table.</p><p>If compilation failed, it returns the exact same things as <a href="compiler.html#compileStmts">compileStmts</a>.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileModuleEx"></a>global function compileModuleEx(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileModuleEx");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Just like <a href="compiler.html#compileModule">compileModule</a>, except if compilation failed, it rethrows the exception, so this function only ever returns successfully.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileStmtsEx"></a>global function compileStmtsEx(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileStmtsEx");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Just like <a href="compiler.html#compileStmts">compileStmts</a>, except if compilation failed, it rethrows the exception, so this function only ever returns successfully.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileExprEx"></a>global function compileExprEx(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileExprEx");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Just like <a href="compiler.html#compileExpr">compileExpr</a>, except if compilation failed, it rethrows the exception, so this function only ever returns successfully.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileModuleDTEx"></a>global function compileModuleDTEx(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileModuleDTEx");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Just like <a href="compiler.html#compileModuleDT">compileModuleDT</a>, except if compilation failed, it rethrows the exception, so this function only ever returns successfully.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="compileStmtsDTEx"></a>global function compileStmtsDTEx(source: string, filename: string = "&lt;compiled from string&gt;")<script>explorer.outline.addDecl("compileStmtsDTEx");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Just like <a href="compiler.html#compileStmtsDT">compileStmtsDT</a>, except if compilation failed, it rethrows the exception, so this function only ever returns successfully.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="runString"></a>global function runString(source: string, filename: string = "&lt;compiled from string&gt;", env: namespace = null)<script>explorer.outline.addDecl("runString");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>A little convenience function to run a string of code containing Croc statements.</p><p>This basically compiles the statements, instantiates the funcdef using the <tt>env</tt> namespace, calls the function, and returns all the values it does.</p><p>Note that this code cannot access local variables from the function that called this! This is just how Croc works.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">source</td><td><p>is the source code.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">filename</td><td><p>is the filename which will be used in compiler errors and debug locations.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">env</td><td><p>is the environment in which the statements should be executed. If you don't pass anything for this parameter, the statements will be evaluated in the environment of the function that called this.</p></td></tr></table><p><strong>Returns:</strong> <p>any values that the compiled code returned after being executed.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="eval"></a>global function eval(source: string, filename: string = "&lt;compiled from string&gt;", env: namespace = null)<script>explorer.outline.addDecl("eval");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Similar to <a href="compiler.html#runString">runString</a>, but evaluates a single expression instead of statements.</p><p>This basically compiles the expression, instantiates the funcdef using the <tt>env</tt> namespace, calls the function, and returns the value it does.</p><p>Note that this code cannot access local variables from the function that called this! This is just how Croc works.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">source</td><td><p>is the source code.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">filename</td><td><p>is the filename which will be used in compiler errors and debug locations.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">env</td><td><p>is the environment in which the expression should be executed. If you don't pass anything for this parameter, the expression will be evaluated in the environment of the function that called this.</p></td></tr></table><p><strong>Returns:</strong> <p>the result of evaluating the expression.</p></dd></dl><script>explorer.outline.decSymbolLevel();</script>	</div><div id="docfooter">		HTML and JavaScript source derived from 		<img src="candydoc/img/candydoc.gif" style="vertical-align:middle; position:relative; top:-1px">		by Victor Nakoryakov; Page generated on 15 Nov 2014 10:28:14	</div></div><script>	explorer.packageExplorer.addModuleFull("array");	explorer.packageExplorer.addModuleFull("ascii");	explorer.packageExplorer.addModuleFull("compiler");	explorer.packageExplorer.addModuleFull("console");	explorer.packageExplorer.addModuleFull("debug");	explorer.packageExplorer.addModuleFull("devil");	explorer.packageExplorer.addModuleFull("docs");	explorer.packageExplorer.addModuleFull("doctools.console");	explorer.packageExplorer.addModuleFull("doctools.output");	explorer.packageExplorer.addModuleFull("doctools.trac");	explorer.packageExplorer.addModuleFull("env");	explorer.packageExplorer.addModuleFull("exceptions");	explorer.packageExplorer.addModuleFull("file");	explorer.packageExplorer.addModuleFull("gc");	explorer.packageExplorer.addModuleFull("gl");	explorer.packageExplorer.addModuleFull("glfw");	explorer.packageExplorer.addModuleFull("hash");	explorer.packageExplorer.addModuleFull("imgui");	explorer.packageExplorer.addModuleFull("json");	explorer.packageExplorer.addModuleFull("math");	explorer.packageExplorer.addModuleFull("memblock");	explorer.packageExplorer.addModuleFull("modules");	explorer.packageExplorer.addModuleFull("object");	explorer.packageExplorer.addModuleFull("openal");	explorer.packageExplorer.addModuleFull("os");	explorer.packageExplorer.addModuleFull("path");	explorer.packageExplorer.addModuleFull("pcre");	explorer.packageExplorer.addModuleFull("repl");	explorer.packageExplorer.addModuleFull("serialization");	explorer.packageExplorer.addModuleFull("stream");	explorer.packageExplorer.addModuleFull("string");	explorer.packageExplorer.addModuleFull("text");	explorer.packageExplorer.addModuleFull("thread");	explorer.packageExplorer.addModuleFull("time");</script></div></body></html>