<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="text/javascript" http-equiv="content-script-type"><title>module repl</title><link rel="stylesheet" type="text/css" href="candydoc/style.css"><link rel="stylesheet" type="text/css" href="candydoc/code.css"><script language="JavaScript" src="candydoc/util.js" type="text/javascript"></script><script language="JavaScript" src="candydoc/tree.js" type="text/javascript"></script><script language="JavaScript" src="candydoc/explorer.js" type="text/javascript"></script></head><body><div id="everything"><div id="tabarea"></div><div id="explorerclient"></div><div id="content"><script>explorer.initialize("repl");</script>	<img src="candydoc/img/banner.gif" alt="The Croc Programming Language"></img>	<div id="docbody">		<h1>module repl</h1><p>This module implements a simple REPL (read-eval-print loop) which is agnostic to input and output. This is what the interactive Croc interpreter uses.</p><script>explorer.outline.incSymbolLevel();</script><dl><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="ExitObj"></a>class ExitObj<script>explorer.outline.addDecl("ExitObj");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>This is the type of the 'exit' global object which <a href="repl.html#interactive">interactive</a> inserts into the global namespace. It's not exported as a global, but some of its methods are used publicly anyway.</p><script>explorer.outline.incSymbolLevel();</script><dl><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="ExitObj.toString"></a>function ExitObj.toString()<script>explorer.outline.addDecl("ExitObj.toString");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p><strong>Returns:</strong> <p>a message telling how to end the REPL.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="ExitObj.opCall"></a>function ExitObj.opCall()<script>explorer.outline.addDecl("ExitObj.opCall");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Calling an instance of this object causes the REPL to terminate.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="ExitObj.original"></a>function ExitObj.original()<script>explorer.outline.addDecl("ExitObj.original");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>If there was already an 'exit' in the global namespace when the REPL started, this method will return the value of that object; otherwise, returns null.</p></dd></dl><script>explorer.outline.decSymbolLevel();</script></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="runString"></a>global function runString(inout, buffer: string)<script>explorer.outline.addDecl("runString");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Runs a string as if it were typed into a REPL. If it looks like a delcaration of some kind, tries to parse and run it as a statement; otherwise, tries to parse and run it as an expression first, falling back to parsing it as a statement if that fails.</p><p>The string will be executed in the global environment, unless <tt>inout</tt> implements a <tt>run</tt> method, in which case it's <tt>inout</tt>'s responsibility to choose which environment to execute it in.</p><p><strong>Params:</strong> <table class="params"><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">inout</td><td><p>should be an already-initialized object of the same kind you pass to <a href="repl.html#interactive">interactive</a>.</p></td></tr><tr><td class="paramname" nowrap valign="top" style="padding-right: 8px">buffer</td><td><p>should contain the code to be run.</p></td></tr></table><p><strong>Returns:</strong> <p>two values.</p><p>The first is a bool telling whether or not more text is needed to be typed to make the code compile. That is, if this returns <tt>true</tt>, it means <tt>buffer</tt> does not contain a complete statement or expression. Returning <tt>false</tt> does not mean the code executed successfully, only that it compiled successfully.</p><p>The second is the compilation exception object if the first value was <tt>true</tt>, and <tt>null</tt> otherwise.</p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="interactive"></a>global function interactive(inout)<script>explorer.outline.addDecl("interactive");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>Runs a REPL using the given <tt>inout</tt> object to perform textual input and output.</p><p>The <tt>inout</tt> object must implement the following methods:</p><p><ul><li><p><strong><tt>write(vararg)</tt></strong>: take a variadic number of strings, and output them.</p></li><li><p><strong><tt>writeln(vararg)</tt></strong>: same as <tt>write</tt>, but also output a newline afterwards.</p></li><li><p><strong><tt>readln(prompt: string)</tt></strong>: display a prompt with the text <tt>prompt</tt>, read text from the user, and return it as a string. Can also return <tt>null</tt> to mean that the REPL should stop.</p></li></ul></p><p>The <tt>inout</tt> object may optionally implement the following methods:</p><p><ul><li><p><strong><tt>init()</tt></strong>: called once before calling any other methods, allows it to initialize any state needed.</p></li><li><p><strong><tt>cleanup()</tt></strong>: called once when the REPL stops for any reason, allows it to do any cleanup needed.</p></li><li><p><strong><tt>run(f: funcdef)</tt></strong>: called with a funcdef which is the compiled version of the entered code. Should return all results from calling the function resulting from closing <tt>f</tt>.</p></li></ul></p><p>The operation of this function goes something like this:</p><p><ol type="1"><li><p>If any exists, the <tt>init</tt> method is called on <tt>inout</tt>.</p></li><li><p>An <a href="repl.html#ExitObj">'exit' object</a> is set up in the global namespace to allow the user to stop the REPL by calling it. Any existing global named 'exit' is saved.</p></li><li><p>A message is printed to <tt>inout</tt> telling how to stop the REPL.</p></li><li><p>The REPL enters its loop. <ol type="a"><li><p>It calls <tt>inout.readln</tt> to get a line of text.</p></li><li><p>If <tt>inout.readln</tt> returns <tt>null</tt> or a string that contains ASCII 4 (Ctrl+D), the loop ends.</p></li><li><p>It builds up a buffer from the lines of text returned by <tt>inout.readln</tt>, calling <a href="repl.html#runString">runString</a> on the buffer until it no longer wants any more text, at which point the buffer is emptied.</p></li><li><p>If <tt>exit()</tt> has been called, the loop ends.</p></li></ol></p></li><li><p>This step happens even if an exception occurred: If there was an existing 'exit' global, it is restored. Then <tt>inout</tt>'s <tt>cleanup</tt> method, if one exists, is called.</p></li></ol></p></dd><script>explorer.outline.writeEnabled = true;</script><dt><span class="decl"><a id="ConsoleInout"></a>class ConsoleInout<script>explorer.outline.addDecl("ConsoleInout");</script></span><script>explorer.outline.writeEnabled = false;</script></dt><dd><p>This class is an input/output object which reads from and writes to the standard input and output streams in the <a href="console.html">console</a> module. Just pass this class as the parameter to <a href="repl.html#interactive">interactive</a> to start an interactive prompt on the console, like <tt>repl.interactive(repl.ConsoleInout)</tt>.</p><script>explorer.outline.incSymbolLevel();</script><dl></dl><script>explorer.outline.decSymbolLevel();</script></dd></dl><script>explorer.outline.decSymbolLevel();</script>	</div><div id="docfooter">		HTML and JavaScript source derived from 		<img src="candydoc/img/candydoc.gif" style="vertical-align:middle; position:relative; top:-1px">		by Victor Nakoryakov; Page generated on 15 Nov 2014 10:28:14	</div></div><script>	explorer.packageExplorer.addModuleFull("array");	explorer.packageExplorer.addModuleFull("ascii");	explorer.packageExplorer.addModuleFull("compiler");	explorer.packageExplorer.addModuleFull("console");	explorer.packageExplorer.addModuleFull("debug");	explorer.packageExplorer.addModuleFull("devil");	explorer.packageExplorer.addModuleFull("docs");	explorer.packageExplorer.addModuleFull("doctools.console");	explorer.packageExplorer.addModuleFull("doctools.output");	explorer.packageExplorer.addModuleFull("doctools.trac");	explorer.packageExplorer.addModuleFull("env");	explorer.packageExplorer.addModuleFull("exceptions");	explorer.packageExplorer.addModuleFull("file");	explorer.packageExplorer.addModuleFull("gc");	explorer.packageExplorer.addModuleFull("gl");	explorer.packageExplorer.addModuleFull("glfw");	explorer.packageExplorer.addModuleFull("hash");	explorer.packageExplorer.addModuleFull("imgui");	explorer.packageExplorer.addModuleFull("json");	explorer.packageExplorer.addModuleFull("math");	explorer.packageExplorer.addModuleFull("memblock");	explorer.packageExplorer.addModuleFull("modules");	explorer.packageExplorer.addModuleFull("object");	explorer.packageExplorer.addModuleFull("openal");	explorer.packageExplorer.addModuleFull("os");	explorer.packageExplorer.addModuleFull("path");	explorer.packageExplorer.addModuleFull("pcre");	explorer.packageExplorer.addModuleFull("repl");	explorer.packageExplorer.addModuleFull("serialization");	explorer.packageExplorer.addModuleFull("stream");	explorer.packageExplorer.addModuleFull("string");	explorer.packageExplorer.addModuleFull("text");	explorer.packageExplorer.addModuleFull("thread");	explorer.packageExplorer.addModuleFull("time");</script></div></body></html>